
    sudo umount -vR /boot

    sudo mount -v /dev/nvme0n1p3 /mnt

    sudo cp -arv /mnt/. /boot

    sudo umount -v /mnt
    sudo sed -i.original '/\/boot.*ext4/d' /etc/fstab
    sudo systemctl daemon-reload
    sudo mount -va

    sudo restorecon -RFv /boot

    echo 'GRUB_ENABLE_CRYPTODISK=y' | sudo tee -a /etc/default/grub
    sudo grub2-mkconfig -o /boot/grub2/grub.cfg

    sudo grubby --info=DEFAULT

    sudo sh -c 'rm -i /boot/loader/entries/*.conf'

    sudo kernel-install -v add $(uname -r) /lib/modules/$(uname -r)/vmlinuz

    sudo grubby --info=DEFAULT

    lsblk -po name,uuid,mountpoints /dev/nvme0n1

    CRYPTOUUID="$(sudo cryptsetup luksUUID /dev/nvme0n1p2 | tr -d -)"
    sudo sed -i.backup1 "1i cryptomount -u ${CRYPTOUUID}" /boot/efi/EFI/fedora/grub.cfg

    OLDUUID="$(lsblk -dno uuid /dev/nvme0n1p3)"
    NEWUUID="$(lsblk -dno uuid /dev/mapper/luks-$(sudo cryptsetup luksUUID /dev/nvme0n1p2))"
    sudo sed -i.backup2 "s/${OLDUUID}/${NEWUUID}/" /boot/efi/EFI/fedora/grub.cfg

    sudo sed -i.backup3 's#($dev)/grub2#($dev)/boot/grub2#' /boot/efi/EFI/fedora/grub.cfg

    sudo cryptsetup luksDump /dev/nvme0n1p2 | grep 'PBKDF:'

    sudo cryptsetup luksChangeKey \
        --key-slot 0 \
        --pbkdf pbkdf2 \
        --pbkdf-force-iterations 500000 \
        --force-password \
        /dev/nvme0n1p2

    sudo cryptsetup luksDump /dev/nvme0n1p2
